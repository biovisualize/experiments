<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title></title>
  <script type='text/javascript' src="../lib/d3.js"></script>
  <script type='text/javascript' src="bar_chart.js"></script>
  <script type='text/javascript' src="container.js"></script>
  <style>
    body {
      font: 14px sans-serif;
    }
    .axis path, .axis line {
      fill: none;
      stroke: black;
      shape-rendering: crispEdges;
    }
    .axis path{
      fill: none;
      stroke: black;
    }
    .bar {
      fill: steelblue;
    }
    svg{
      border: 1px solid silver;
    }
    svg rect{
      fill: aliceblue;
      stroke: black;
    }
  </style>
</head>
<body>

<!--<div id="container"></div>-->
<div id="container2"></div>

<script type="text/javascript">

  function shuffle(d){for(var c=d.length-1;c>0;c--){var b=Math.floor(Math.random()*(c+1));var a=d[c];d[c]=d[b];d[b]=a}return d};
  function pickRandom(arr){ return Math.floor(arr[~~(Math.random()*arr.length)]*100)/100; }
  function range(lower, upper){ return d3.range(upper-lower).map(function(d, i){ return d+lower; }); }
  function randomColor(){ return 'rgb('+~~(Math.random()*100+155)+','+~~(Math.random()*100+155)+','+~~(Math.random()*100+155)+')'; }
  var letters = d3.range(26).map(function(d, i){ return String.fromCharCode(d + 65); });
  var shuffleLetters = shuffle(letters);

  function generateDataset(){
    return d3.range(8).map(function(d, i){
      var rndLetter = shuffleLetters.pop(~~(Math.random()*(letters.length)));
      return {
        car: rndLetter,
        mpg: ~~(Math.random()*30 + 1),
        gear: ~~(Math.random()*3) + 1,
        wt: 1,
        cyl: pickRandom([4, 6, 8]),
        qsec: pickRandom(range(15, 25)),
        hp: pickRandom(range(90, 500)),
        am: pickRandom([0, 1]),
        vs: pickRandom([0, 1])
      };
    });
  }


  function generateChart(){
    var carsDataset1 = generateDataset();
    var carsDataset2 = generateDataset();

    var data1 = carsDataset1.map(function(d, i){ return {name: d.car, value: d.mpg}; });
    var data2 = carsDataset2.map(function(d, i){ return {name: d.car, value: d.mpg}; });

    var svg = d3.select('#container')
        .selectAll('svg')
        .data([0]);
    svg.enter().append('svg')

    var containers = svg.selectAll('g.chart')
        .data([randomColor(), randomColor(), randomColor(), randomColor(), randomColor(), randomColor()]);
    containers.enter().append('g')
        .attr({'class': function(d, i){ return 'chart'+i; }})
        .classed('chart', true);

    containers.datum(function(d, i){ return d; })
        .call(d3.custom.Grid().columnNumber(2));
  }

//  generateChart();

//  d3.select('body').on('click', generateChart);


    var data = [[0, 1, 2, 3], [4, 5, 6, 7], [4, 5, 6, 7]];
//  var data = [[0, 1, 2, 3], [4, 5, 6, 7]];
  var svg = d3.select('#container2').append('svg');

  // chart space
  var w = 800, h = 500,
      titleSize = 50,
      chartSpaceX = titleSize,
      chartSpaceY = titleSize,
      chartSpaceW = w - titleSize * 2,
      chartSpaceH = h - titleSize * 2;
//  svg.append('rect').attr({x: chartSpaceX, y: chartSpaceY, width: chartSpaceW, height: chartSpaceH});

  // facets
  var axisSize = 30,
      gridRowNum = data[0].length,
      gridColNum = data.length,
      facetW = (chartSpaceW - axisSize * 2)/gridRowNum,
      facetH = (chartSpaceH - axisSize * 2)/gridColNum;
  var chartW = facetW,
      chartH = facetH;


  var facetRow = svg.selectAll('g.facet-row')
      .data(data)
      .enter().append('g')
      .classed('facet-row', true);

  // y axis label
  svg.append('rect').attr({x: 0, y: titleSize, width: titleSize, height: h - titleSize * 2});
  // chart title
  svg.append('rect').attr({x: titleSize, y: 0, width: w - titleSize * 2, height: titleSize});
  // legend
  svg.append('rect').attr({x: w - titleSize, y: titleSize, width: titleSize, height: h - titleSize * 2});
  // x axis label
  svg.append('rect').attr({x: titleSize, y: h - titleSize, width: w - titleSize * 2, height: titleSize});

  var facetGroup = facetRow.selectAll('g.facet-group')
      .data(function(d, i){ return d; })
      .enter().append('g')
      .classed('facet-group', true);
  facetGroup.filter(function(d, i){ return i == 0; }).append('rect').classed('axis-y', true)
      .attr({
        x: chartSpaceX,
        y: function(d, i, pI){ return chartSpaceY + axisSize + chartH * pI; },
        width: axisSize,
        height: facetH
      });
  facetGroup.filter(function(d, i){ return i == data[0].length - 1; }).append('rect').classed('tab-y', true)
      .attr({
        x: function(d, i, pI){ return chartSpaceX + axisSize + chartW * data[pI].length - 1; },
        y: function(d, i, pI){ return chartSpaceY + axisSize + chartH * pI; },
        width: axisSize,
        height: facetH
      });
  facetGroup.append('rect')
      .attr({
        'class': function(d, i, pI){ return 'chart_' + [i, pI].join('-'); },
        x: function(d, i){ return chartSpaceX + axisSize + chartW * i; },
        y:function(d, i, pI){ return chartSpaceY + axisSize + chartH * pI; },
        width: chartW,
        height: chartH
      })
      .classed('chart', true);

  var facetTabs = facetRow.filter(function(d, i){ return i == 0; }).selectAll('g.row-tab-x')
      .data(function(d, i){ return d; })
      .enter().append('g')
      .classed('row-tab-x', true);
  facetTabs.append('rect').classed('tab-x', true)
      .attr({
        x: function(d, i, pI){ return chartSpaceX + axisSize + chartW * i; },
        y: function(d, i, pI){ return chartSpaceY + chartH * pI; },
        width: chartW,
        height: axisSize
      });

  var facetTabs = facetRow.filter(function(d, i){ return i == data.length - 1; }).selectAll('g.row-axis-x')
      .data(function(d, i){ return d; })
      .enter().append('g')
      .classed('row-axis-x', true);
  facetTabs.append('rect').classed('axis-x', true)
      .attr({
        x: function(d, i){ return chartSpaceX + axisSize + chartW * i; },
        y: function(d, i){ return chartSpaceY + axisSize + chartH * data.length; },
        width: chartW,
        height: axisSize
      });



</script>

</body>
</html>