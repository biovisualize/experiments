<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title></title>
  <script type='text/javascript' src="../lib/d3.js"></script>
  <script type='text/javascript' src="plain_bar_chart.js"></script>
  <script type='text/javascript' src="labels.js"></script>
  <script type='text/javascript' src="facets.js"></script>
  <script type='text/javascript' src="axes.js"></script>
  <style>
    body {
      font: 14px sans-serif;
    }
    .axis path, .axis line {
      fill: none;
      stroke: black;
      shape-rendering: crispEdges;
    }
    .axis path{
      fill: none;
      stroke: black;
    }
    .bar {
      fill: steelblue;
    }
    svg{
      border: 1px solid silver;
    }
    svg rect{
      fill: aliceblue;
      stroke: grey;
    }
    path.domain{
      stroke: black;
      fill: none;
    }
    .tick line{
      stroke: black;
    }
    .tick text{
      font-size: 8px;
    }
  </style>
</head>
<body>

<!--<div id="container"></div>-->
<div id="container2"></div>

<script type="text/javascript">

/*
TODO:
-data input
-wrap axis and scale
-single chart
-zoom to single chart

-free scale
-legend
-brush
*/

  /*
    advantage of rewriting it from scratch:
    -generic faceting container
    -reusable charts
    -json spec decoupled from chart assembly
    -composition instead of hierarchy
    -decoupled from data format
    -testable (not just testing any output)
    -update/enter/exit
   */


  // data
  //////////////////////////////////////////////////////

  function shuffle(d){for(var c=d.length-1;c>0;c--){var b=Math.floor(Math.random()*(c+1));var a=d[c];d[c]=d[b];d[b]=a}return d};
  function pickRandom(arr){ return Math.floor(arr[~~(Math.random()*arr.length)]*100)/100; }
  function range(lower, upper){ return d3.range(upper-lower).map(function(d, i){ return d+lower; }); }
  function randomColor(){ return 'rgb('+~~(Math.random()*100+155)+','+~~(Math.random()*100+155)+','+~~(Math.random()*100+155)+')'; }
  var letters = d3.range(26).map(function(d, i){ return String.fromCharCode(d + 65); });
  var shuffleLetters = shuffle(letters);

  function generateDataset(){
    return d3.range(8).map(function(d, i){
      var rndLetter = shuffleLetters.pop(~~(Math.random()*(letters.length)));
      return {
        car: rndLetter,
        mpg: ~~(Math.random()*30 + 1),
        gear: ~~(Math.random()*3) + 1,
        wt: 1,
        cyl: pickRandom([4, 6, 8]),
        qsec: pickRandom(range(15, 25)),
        hp: pickRandom(range(90, 500)),
        am: pickRandom([0, 1]),
        vs: pickRandom([0, 1])
      };
    });
  }

  function getTextSize(text){
    var svg = d3.select('body').append('svg');
    var test = svg.node().appendChild(text).getBBox();
    svg.remove();
    return 0;
  }

  var data = [[0, 1, 2, 3], [4, 5, 6, 7], [8, 9, 10, 11]];
//  var data = [[0, 1, 2], [4, 5, 6], [8, 9, 10]];
//  var data = [[0, 1, 2, 3], [4, 5, 6, 7]];
  var showZones = false;


  // chart space
  var w = 800, h = 500,
      titleSize = 25,
      legendSize = 60,
      gap = 5,
      axisSize = 25,
      tabSize = 25,
      gridRowNum = data.length,
      gridColNum = data[0].length,
      facetW = (w - titleSize - legendSize - axisSize - tabSize) / gridColNum,
      facetH = (h - titleSize * 2 - axisSize - tabSize) / gridRowNum;

  var svg = d3.select('#container2').append('svg')
      .attr({width: w, height: h});

  // titles
  //////////////////////////////////////////////////////

  var labels = d3.custom.Labels()
      .config({
        w: w,
        h: h,
        titleSize: titleSize,
        showZones: showZones,
        legendSize: legendSize
      });

  svg.call(labels);


  // facets
  //////////////////////////////////////////////////////

  var facets = d3.custom.Facets()
      .config({
        x: titleSize,
        y: titleSize,
        facetW: facetW,
        facetH: facetH,
        tabSize: tabSize,
        axisSize: axisSize,
        gap: gap,
        showZones: showZones,
        gridColNum: gridColNum,
        gridRowNum: gridRowNum
      });

  svg.call(facets);

  // chart
  //////////////////////////////////////////////////////

  var dataY = [1, 2, 3, 4, 5, 6];
  var dataX = ['A', 'B', 'C', 'D', 'E', 'F'];

  var axes = d3.custom.Axes()
      .config({
        facetW: facetW,
        facetH: facetH,
        gap: gap,
        dataX: dataX,
        dataY: dataY,
        axisSize: axisSize
      });
  svg.call(axes)


  var chartW = facetW - gap;
  var chartH = facetH - gap;
  d3.selectAll('.chart')
      .call(d3.custom.PlainBarChart().width(chartW).height(chartH));



</script>

</body>
</html>